<!doctype html>
index 88319a4a8e68a9bb18c0c53317f32cbe62045bbf..5aa18ee105d77c50c0b686127290806652559660 100644
--- a/index.html
+++ b/index.html
@@ -8,50 +8,51 @@
     body { font-family: Arial, sans-serif; max-width: 1250px; margin: 24px auto; padding: 0 16px; }
     h1 { margin: 0 0 6px; }
     p { margin: 0 0 14px; color: #444; }
     .grid { display: grid; grid-template-columns: 1.15fr 0.85fr; gap: 12px; }
     .card { background:#fafafa; border:1px solid #eee; border-radius:16px; padding:14px; }
     label { display:block; font-weight:700; margin: 10px 0 6px; }
     input, select, textarea, button {
       width:100%; padding:10px; border-radius:10px; border:1px solid #ccc; box-sizing:border-box; font-size:14px;
     }
     textarea { min-height:160px; resize: vertical; }
     button { cursor:pointer; border:none; background:#1f7a5b; color:#fff; font-weight:800; }
     button.secondary { background:#444; }
     button.ghost { background:#eaeaea; color:#222; border:1px solid #ddd; }
     .actions { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
     .small { font-size:12px; color:#666; }
     .row2 { display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
     .row3 { display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; }
     .pill { display:inline-block; padding:2px 8px; border-radius:999px; background:#e9f5ef; border:1px solid #cfe8dd; font-size:12px; color:#185a43; }
     table { width:100%; border-collapse: collapse; margin-top:10px; background:#fff; border-radius:12px; overflow:hidden; }
     th, td { border-bottom:1px solid #eee; padding:8px; font-size:13px; text-align:left; vertical-align:top; }
     th { background:#f3f3f3; }
     tr:hover { background:#fbfbfb; }
     .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
     .inline { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
     .inline > * { flex: 1; min-width: 180px; }
+    .badge-urgent { display:inline-block; padding:2px 8px; border-radius:999px; background:#ffe1e1; color:#8b1d1d; border:1px solid #f1bcbc; font-size:11px; font-weight:700; }
   </style>
 </head>
 <body>
   <h1>G√©n√©rateur de messages + mini CRM</h1>
   <p>
     <span class="pill">CSV + statuts + relances auto</span> ‚Ä¢ gratuit ‚Ä¢ fonctionne partout
   </p>
 
   <div class="grid">
     <!-- LEFT -->
     <div class="card">
       <div class="row3">
         <div>
           <label for="prenom">Pr√©nom</label>
           <input id="prenom" placeholder="Ex: Julie" />
         </div>
         <div>
           <label for="plateforme">Plateforme</label>
           <select id="plateforme">
             <option>Instagram</option>
             <option>Facebook</option>
             <option>TikTok</option>
             <option>LinkedIn</option>
             <option>WhatsApp</option>
           </select>
@@ -208,50 +209,51 @@
 
       <table>
         <thead>
           <tr>
             <th>Pr√©nom</th>
             <th>Plateforme</th>
             <th>Statut</th>
             <th>Prochaine relance</th>
             <th>Note</th>
           </tr>
         </thead>
         <tbody id="contactTableBody"></tbody>
       </table>
 
       <div class="small" style="margin-top:10px;">
         Astuce : ‚Äú√Ä relancer‚Äù + Objectif = Relance J+7/J+14 ‚Üí calcule automatiquement la prochaine relance.
       </div>
     </div>
   </div>
 
   <script>
     const $ = (id) => document.getElementById(id);
     const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];
     const clean = (s) => (s || "").trim();
     const STORAGE_KEY = "mlm_contacts_v2";
+    let selectedKey = "";
 
     // --------- dates helpers ---------
     function todayISO() {
       const d = new Date();
       const y = d.getFullYear();
       const m = String(d.getMonth() + 1).padStart(2, "0");
       const day = String(d.getDate()).padStart(2, "0");
       return `${y}-${m}-${day}`;
     }
 
     function addDaysISO(baseISO, addDays) {
       const base = baseISO ? new Date(baseISO + "T00:00:00") : new Date();
       const d = new Date(base.getTime());
       d.setDate(d.getDate() + addDays);
       const y = d.getFullYear();
       const m = String(d.getMonth() + 1).padStart(2, "0");
       const day = String(d.getDate()).padStart(2, "0");
       return `${y}-${m}-${day}`;
     }
 
     function daysSince(dateStr) {
       if (!dateStr) return null;
       const d = new Date(dateStr + "T00:00:00");
       const now = new Date();
       const ms = now - d;
@@ -405,137 +407,163 @@
         persona: $("persona").value,
         intention: $("intention").value,
         statut: $("statut").value,
         date_creation: $("dateCreation").value || "",
         dernier: $("dernier").value || "",
         prochaine_relance: $("prochaine").value || "",
         centre: clean($("centre").value),
         accroche: clean($("accroche").value),
         note: clean($("note").value)
       };
     }
 
     function computeNextFollowUp(c) {
       // Si statut n'est pas "√Ä relancer", on ne touche pas (sauf si vide et statut √Ä relancer)
       if (c.statut !== "√Ä relancer") return c.prochaine_relance || "";
 
       // Base : si dernier contact existe => base=dernier sinon aujourd'hui
       const base = c.dernier || todayISO();
 
       // Si objectif relance7/14 => respect
       if (c.objectif === "relance14") return addDaysISO(base, 14);
       return addDaysISO(base, 7); // d√©faut relance7
     }
 
     function fillFormFromContact(c) {
+      selectedKey = contactKey(c);
       $("prenom").value = c.prenom || "";
       $("plateforme").value = c.plateforme || "Instagram";
       $("relation").value = c.relation || "froid";
       $("objectif").value = c.objectif || "discussion";
       $("styleTone").value = c.style || "neutre";
       $("lengthMode").value = c.longueur || "normal";
       $("persona").value = c.persona || "indefini";
       $("intention").value = c.intention || "reseau";
       $("statut").value = c.statut || "Nouveau";
       $("dateCreation").value = c.date_creation || "";
       $("dernier").value = c.dernier || "";
       $("prochaine").value = c.prochaine_relance || "";
       $("centre").value = c.centre || "";
       $("accroche").value = c.accroche || "";
       $("note").value = c.note || "";
       generate();
     }
 
     function refreshUI() {
       const contacts = loadContacts();
+      const today = todayISO();
       const sel = $("contactSelect");
       sel.innerHTML = "";
       const o0 = document.createElement("option");
       o0.value = ""; o0.textContent = "‚Äî s√©lectionner ‚Äî";
       sel.appendChild(o0);
 
-      contacts.slice().sort((a,b)=> (a.prenom||"").localeCompare(b.prenom||"")).forEach((c, idx) => {
+      contacts.slice().sort((a,b)=> (a.prenom||"").localeCompare(b.prenom||"")).forEach((c) => {
         const o = document.createElement("option");
-        o.value = String(idx);
+        o.value = contactKey(c);
         o.textContent = `${c.prenom || "(sans pr√©nom)"} ‚Ä¢ ${c.plateforme || ""}`;
         sel.appendChild(o);
       });
 
+      if (selectedKey) {
+        sel.value = selectedKey;
+      }
+
+      const contactsForDisplay = contacts
+        .map((c, idx) => ({ c, idx }))
+        .slice()
+        .sort((a, b) => {
+          const da = a.c.prochaine_relance || "";
+          const db = b.c.prochaine_relance || "";
+          if (!da && !db) return 0;
+          if (!da) return 1;
+          if (!db) return -1;
+          return da.localeCompare(db);
+        });
       const tbody = $("contactTableBody");
       tbody.innerHTML = "";
-      contacts.forEach((c, idx) => {
+      contactsForDisplay.forEach(({ c, idx }) => {
         const tr = document.createElement("tr");
         tr.style.cursor = "pointer";
         tr.title = "Clique pour charger ce contact";
         tr.addEventListener("click", () => {
-          $("contactSelect").value = String(idx);
+          selectedKey = contactKey(c);
+          $("contactSelect").value = selectedKey;
           fillFormFromContact(c);
         });
 
         const td1 = document.createElement("td"); td1.textContent = c.prenom || "";
         const td2 = document.createElement("td"); td2.textContent = c.plateforme || "";
-        const td3 = document.createElement("td"); td3.textContent = c.statut || "";
+        const td3 = document.createElement("td");
+        td3.textContent = c.statut || "";
+        if (c.statut === "√Ä relancer" && c.prochaine_relance && c.prochaine_relance <= today) {
+          const badge = document.createElement("span");
+          badge.className = "badge-urgent";
+          badge.textContent = "URGENT";
+          td3.append(" ", badge);
+        }
         const td4 = document.createElement("td"); td4.textContent = c.prochaine_relance || "";
         const td5 = document.createElement("td"); td5.textContent = c.note || "";
         tr.append(td1, td2, td3, td4, td5);
         tbody.appendChild(tr);
       });
     }
 
     function addOrUpdateContact() {
       const c = getFormAsContact();
       if (!c.prenom) { alert("Ajoute au moins un pr√©nom pour enregistrer üôÇ"); return; }
 
       const contacts = loadContacts();
       const key = contactKey(c);
       const i = contacts.findIndex(x => contactKey(x) === key);
 
       // Date cr√©ation auto si nouveau
       if (i < 0 && !c.date_creation) c.date_creation = todayISO();
 
       // Prochaine relance auto si statut "√Ä relancer" et champ vide OU si tu veux recalculer : on recalc si statut √Ä relancer
       c.prochaine_relance = computeNextFollowUp(c);
 
       // Met √† jour l'affichage du champ dateCreation + prochaine
       $("dateCreation").value = c.date_creation;
       $("prochaine").value = c.prochaine_relance;
 
       if (i >= 0) contacts[i] = c; else contacts.push(c);
       saveContacts(contacts);
       refreshUI();
     }
 
     function deleteSelectedContact() {
-      const idx = $("contactSelect").value;
-      if (idx === "") return;
+      const key = $("contactSelect").value;
+      if (!key) return;
       const contacts = loadContacts();
-      const i = Number(idx);
-      if (Number.isNaN(i) || i < 0 || i >= contacts.length) return;
+      const i = contacts.findIndex((c) => contactKey(c) === key);
+      if (i < 0) return;
       const name = contacts[i]?.prenom || "ce contact";
       if (!confirm(`Supprimer ${name} ?`)) return;
       contacts.splice(i, 1);
       saveContacts(contacts);
+      if (selectedKey === key) selectedKey = "";
       refreshUI();
     }
 
     // --------- CSV ---------
     const CSV_HEADERS = ["prenom","plateforme","relation","objectif","style","longueur","persona","intention","statut","date_creation","dernier","prochaine_relance","centre","accroche","note"];
 
     function escapeCSV(value) {
       const s = String(value ?? "");
       if (/[",\n\r;]/.test(s)) return `"${s.replace(/"/g, '""')}"`;
       return s;
     }
 
     function toCSVRow(obj) {
       return CSV_HEADERS.map(h => escapeCSV(obj[h] ?? "")).join(",");
     }
 
     function exportCSV() {
       const contacts = loadContacts();
       const lines = [CSV_HEADERS.join(",")];
       contacts.forEach(c => lines.push(toCSVRow(c)));
       const csv = lines.join("\n");
 
       const blob = new Blob([csv], { type: "text/csv;charset=utf-8" });
       const url = URL.createObjectURL(blob);
 
@@ -644,56 +672,56 @@
         alert("Copie impossible. S√©lectionne le texte et fais Ctrl+C.");
       }
     });
 
     $("btnClear").addEventListener("click", () => {
       ["prenom","centre","accroche","note","dernier","prochaine"].forEach(id => $(id).value = "");
       $("dateCreation").value = "";
       $("plateforme").value = "Instagram";
       $("relation").value = "froid";
       $("objectif").value = "discussion";
       $("styleTone").value = "neutre";
       $("lengthMode").value = "normal";
       $("persona").value = "indefini";
       $("intention").value = "reseau";
       $("statut").value = "√Ä relancer";
       $("result").value = "";
       $("debug").textContent = "";
       $("daysInfo").textContent = "";
       generate();
     });
 
     $("btnAdd").addEventListener("click", addOrUpdateContact);
     $("btnDelete").addEventListener("click", deleteSelectedContact);
 
     $("contactSelect").addEventListener("change", () => {
-      const idx = $("contactSelect").value;
-      if (idx === "") return;
+      selectedKey = $("contactSelect").value;
+      if (!selectedKey) return;
       const contacts = loadContacts();
-      const i = Number(idx);
-      if (Number.isNaN(i) || i < 0 || i >= contacts.length) return;
-      fillFormFromContact(contacts[i]);
+      const found = contacts.find((c) => contactKey(c) === selectedKey);
+      if (!found) return;
+      fillFormFromContact(found);
     });
 
     $("btnExport").addEventListener("click", exportCSV);
     $("btnImportBtn").addEventListener("click", () => $("importFile").click());
     $("importFile").addEventListener("change", (e) => {
       const file = e.target.files && e.target.files[0];
       if (!file) return;
       importCSVFile(file);
       e.target.value = "";
     });
 
     // Auto recalcul si tu changes (statut/objectif/dernier)
     function autoSuggestNext() {
       const statut = $("statut").value;
       if (statut !== "√Ä relancer") return;
       const base = $("dernier").value || todayISO();
       const obj = $("objectif").value;
       const next = (obj === "relance14") ? addDaysISO(base, 14) : addDaysISO(base, 7);
       $("prochaine").value = next;
     }
     $("statut").addEventListener("change", autoSuggestNext);
     $("objectif").addEventListener("change", autoSuggestNext);
     $("dernier").addEventListener("change", autoSuggestNext);
 
     // init
